/*! d3.chart.base - v0.3.0
 *  License: MIT Expat
 *  Date: 2013-10-07
 */
(function(e){function t(e){var t,i=this.base[0][0];return window.getComputedStyle?t=window.getComputedStyle(i):i.currentStyle&&(t=i.currentStyle),e?t[e]:t}function i(e,i,r){var s=a(t.call(this,i));null===s||0===s||""===s?(this[e]=r,this.base.attr(i,r)):this[e]=a(t.call(this,i))}function r(e,t,i){var r,s,n,a=null,h=0;i=i||{};var o=function(){h=i.leading===!1?0:new Date,a=null,n=e.apply(r,s)};return function(){var l=new Date;h||i.leading!==!1||(h=l);var d=t-(l-h);return r=this,s=arguments,0>=d?(clearTimeout(a),a=null,h=l,n=e.apply(r,s)):a||i.trailing===!1||(a=setTimeout(o,d)),n}}function s(){var e=this._currentMode;if(this._currentMode=null,"modes"in this){var t=!1;for(var i in this._modes)if(t=this._modes[i].call(this)){this._currentMode=i;break}}return e!==this._currentMode}function n(){var e=this;for(var t in e._layersArguments){var i=e._layersArguments[t];if(-1===i.options.modes.indexOf(e.mode())){if(i.showing===!0){var r=e.unlayer(t);r.style("display","none"),e._layersArguments[t].showing=!1,e._layersArguments[t].layer=r}}else e._layersArguments[t].showing===!1&&(null!==e._layersArguments[t].layer?(o.call(e,t,e._layersArguments[t].layer),e._layersArguments[t].layer.style("display","inline")):o.call(e,e._layersArguments[t].name,e._layersArguments[t].selection,e._layersArguments[t].options),e._layersArguments[t].showing=!0)}}var a=function(){var e=/px$/;return function(t){return e.test(t)?+t.replace(e,""):t}}(),h=e.chart("BaseChart",{initialize:function(){var e=this;this._layersArguments={},this._modes=this.modes||{},delete this.modes,this._modeLayers={},s.call(this),e._width=a(t.call(e,"width"))||200,e._height=a(t.call(e,"height"))||200,i.call(this,"_width","width",200),i.call(this,"_height","height",200);var h=function(){e.trigger("_resize:start"),window.removeEventListener("resize",h)};window.addEventListener("resize",h);var o,l;e.on("_resize:start",function(){o=e._width,l=e._height}),window.addEventListener("resize",r(function(){e.trigger("_resize:end");var t=s.call(e);t&&e.trigger("change:mode",this._currentMode),window.addEventListener("resize",h)},60)),window.addEventListener("orientationchange",function(){e.trigger("change:mode",this._currentMode)},!1),e.on("change:mode",function(){e._width=a(t.call(e,"width")),e._height=a(t.call(e,"height")),n.call(e),e.data&&e.draw(e.data)})},mode:function(){return this._currentMode},width:function(e){if(0===arguments.length)return a(t.call(this,"width"));var i=this._width;return this._width=e,this._width!==i&&(this.base.attr("width",this._width),this.trigger("change:width",this._width,i),this.data&&this.draw(this.data)),this},height:function(e){if(0===arguments.length)return a(t.call(this,"height"));var i=this._height;return this._height=e,this._height!==i&&(this.base.attr("height",this._height),this.trigger("change:height",this._height,i),this.data&&this.draw(this.data)),this}}),o=h.prototype.layer;h.prototype.layer=function(e,t,i){var r=this;if(1===arguments.length)return o.call(this,e);r._layersArguments[e]={name:e,selection:t,options:i,showing:!1,layer:null};var s;if((i.modes===void 0||"modes"in i&&i.modes.indexOf(r.mode())>-1)&&(s=o.call(this,e,t,i),r._layersArguments[e].showing=!0,r._layersArguments[e].layer=s),"modes"in i)s&&(s._modes=i.modes),i.modes.forEach(function(t){if(!(t in r._modes))throw Error("Mode "+t+" is not defined");r._modeLayers[t]=r._modeLayers[t]||[],r._modeLayers[t].push(e)});else if(r._modes){var n=Object.keys(r._modes);s&&(s._modes=n),n.forEach(function(t){r._modeLayers[t]=r._modeLayers[t]||[],r._modeLayers[t].push(e)}),r._layersArguments[e].showing=!0,r._layersArguments[e].layer=s}return s}})(window.d3);